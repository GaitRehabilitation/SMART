image: Visual Studio 2017
branches:
  only:
    - master

install:
  - set QTDIR=C:\Qt\5.11.1\msvc2017_64
  - set PATH=%PATH%;%QTDIR%\bin
  
before_build:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"
  - git submodule init
  - git submodule update

build_script:
  - qmake -tp vc
  - msbuild /p:Configuration=Release
  - windeployqt ./release/SensorCapture.exe

after_build:
  - 7z a app.zip >
    .\release\iconengines 
    .\release\imageformats 
    .\release\microsoft.system.package.metadata 
    .\release\platforms\  
    .\release\SensorCapture.tlog\  
    .\release\translations\  
    .\release\*.dll  
    .\release\*.xml
    .\release\*.resfiles
    .\release\*.txt
    .\release\*.log
    .\release\*.exe
    .\release\*.build.appxrecipe

artifacts:
  - path: app.zip
    name: App
